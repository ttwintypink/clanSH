# config.py
# Требуется: discord.py 2.x, python-dotenv
# pip install -U discord.py python-dotenv

import os

# python-dotenv удобно для загрузки .env на Linux/Windows.
# На некоторых хостингах зависимости ставятся не всегда автоматически,
# поэтому делаем мягкий fallback: если dotenv не установлен — просто читаем ENV.
try:
    from dotenv import load_dotenv  # type: ignore
except Exception:  # ImportError и др.
    load_dotenv = None

# ==========================================================
#                       CONFIG
# ==========================================================

if load_dotenv is not None:
    load_dotenv()

TOKEN = os.getenv("DISCORD_TOKEN")
if not TOKEN:
    raise RuntimeError(
        "Токен не найден.\n"
        "Варианты:\n"
        "1) Создай файл .env рядом с main.py и добавь:\n"
        "   DISCORD_TOKEN=ВАШ_ТОКЕН\n"
        "   (нужно установить зависимость python-dotenv)\n"
        "2) Или задай переменную окружения DISCORD_TOKEN в настройках хостинга.\n"
    )

# Категория, где Ticket Tool создаёт тикеты
TICKETS_CATEGORY_ID = 1371053315529637928

# Категория архива
ARCHIVE_CATEGORY_ID = 1287197183954784297

# Роли модераторов: имеют право принимать/отклонять + будут пинговаться
STAFF_ROLE_IDS: list[int] = [
    1300451930900009092,
    1364660029143253082,
    1371955005367779418,
    1320456192568459265,
    1320438406370824305,
    1364549372313993216,
    1349429359290876037,
]

# Роли, которые пингуем (оставляем как было раньше)
STAFF_PING_ROLE_IDS: list[int] = [
    1300451930900009092,
    1364660029143253082,
    1364549372313993216,
]

# (опционально) канал логов (0 = выключено)
LOG_CHANNEL_ID = 1466163549150773363

# Фраза-триггер (Ticket Tool пишет это при попытке закрыть тикет)
TRIGGER_PHRASE = "вы серьезно хотите закрыть данный тикет"

# Анти-спам: не чаще, чем раз в N секунд в одном канале
PROMPT_COOLDOWN_SECONDS = 30

# SQLite
DB_PATH = "tickets.db"

# Инвайт (permanent link)
INVITE_LINK = "https://discord.gg/Pgs8uZffhr"

# Роли для результата заявки
ACCEPT_ADD_ROLE_ID = 1299444337658171422      # выдать при принятии
ACCEPT_REMOVE_ROLE_ID = 1315028367044513876   # забрать при принятии

ACCEPT_EXTRA_DM = """**Так же не забудьте поставить ник по форме в приватке, и добавить приписку в стим профиле!**
*Форма для стима: SH | nick*
*Форма для приватки: Ник | Имя*"""

WELCOME_MESSAGE = """**Шаблон для подачи заявки в клан:** 

```1) Возраст, имя, кол-во часов (на одном аккаунте, пиратки не считаются)
2) Ваши преимущества
3) Роль в клане
4) Играете ли вы час в день на юкн?
5) Был ли опыт в кланах? (если да то в каких)
6) Профиль стим (ТРЕБУЕТСЯ открытый стим аккаунт)
7) Ваш часовой пояс
8) Сколько играете в день
9) Откуда узнали о нас?
10) Ваша характеристика пк (кратко, основные компоненты)
11) Принимаете ли вы обоснованную критику в свою сторону?```

***Заполняйте свою заявку по форме выше!***"""

# -------------------- PRIVATKA SETUP --------------------
# Приватный сервер (гильдия) и канал, где будет сообщение с кнопкой формы
PRIVATE_GUILD_ID = 1454836789331230842
PRIVATE_SETUP_CHANNEL_ID = 1466168457757462741

# Роли в приватке:
# - роль, которую нужно снять после заполнения формы
# - роль, которую нужно выдать после заполнения формы
PRIVATE_REMOVE_ROLE_ID = 1466169062491951164
PRIVATE_ADD_ROLE_ID = 1454842309421170719

# Текст сообщения с кнопкой (можешь поменять позже)
PRIVATE_SETUP_MESSAGE = (
    "**Приватка: установка ника**\n"
    "Нажми кнопку ниже, заполни форму — и я автоматически поставлю тебе ник по формату "
    "**`Ник в стиме | Настоящее имя`** и обновлю роли."
)


# -------------------- TICKET OPENER IGNORE --------------------
# Эти ID НЕ должны считаться "автором тикета" (opener) при регистрации/определении игрока.
# Важно: сюда же можно динамически добавлять ID через сообщение от IGNORE_ADD_ADMIN_ID (см. events.py).
IGNORED_TICKET_OPENER_IDS: set[int] = {
    1069974638706315295,
    1166060811672883210,
    529349299948093440,
    831145749030895617,
    857271131580923914,
    491950199745413121,
}

# Эти роли означают, что пользователь НЕ должен считаться "автором тикета" (opener).
# Если у участника есть хотя бы одна из этих ролей — мы его игнорируем при определении opener.
IGNORED_TICKET_OPENER_ROLE_IDS: set[int] = {
    1300451930900009092,
    1364660029143253082,
    1371955005367779418,
    1320456192568459265,
    1320438406370824305,
    1364549372313993216,
}



# Кто может динамически добавлять ID в игнор (просто отправив боту ID пользователя)
IGNORE_ADD_ADMIN_ID = 1166060811672883210

# -------------------- PRIVATE INVITE SETTINGS --------------------
# Персональный инвайт в приватку при принятии заявки:
# - устаревает через 1 день
# - 1 использование
PRIVATE_INVITE_MAX_AGE_SECONDS = 86400
PRIVATE_INVITE_MAX_USES = 1
